(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y={}.hasOwnProperty,z=function(a,b){function c(){this.constructor=a}for(var d in b)y.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=window.Cruddy||{},p="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",k="&mdash;",o=" / ",moment.lang(null!=(x=e.locale)?x:"en"),Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,$(document).ajaxSend(function(a,b,c){e.app||(c.displayLoading=!1),c.displayLoading&&e.app.startLoading()}).ajaxComplete(function(a,b,c){c.displayLoading&&e.app.doneLoading()}),$(document.body).on("click","[data-trigger=fancybox]",function(a){return $.fancybox.open(a.currentTarget)!==!1?!1:void 0}),$.extend($.fancybox.defaults,{openEffect:"elastic"}),v=function(){return function(a){return a.replace(/_-/," ")}}(this),t=function(a,b){var c;return c=e.baseUrl+"/"+a,b&&(c+="/"+b),c},q=function(a){return setTimeout(a,50)},w=function(a,b,c){var d;return d=""+e.thumbUrl+"?src="+encodeURIComponent(a),b&&(d+="&amp;width="+b),c&&(d+="&amp;height="+c),d},s=function(a){return"<span class='glyphicon glyphicon-"+a+"'></span>"},r=function(a,b,c,d){return null==b&&(b=null),null==c&&(c="btn-default"),null==d&&(d="button"),b&&(a=s(b)+" "+a),_.isArray(c)&&(c="btn-"+c.join(" btn-")),"<button type='"+d+"' class='btn "+c+"'>"+a.trim()+"</button>"},u=function(a,b){var c,d,e,f;if(null==b&&(b=window),_.isEmpty(a))return b;for(f=a.split("."),d=0,e=f.length;e>d;d++){if(c=f[d],!(c in b))return;b=b[c]}return b},b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="span",b.prototype.className="alert",b.prototype.initialize=function(a){var b;return this.$el.addClass(null!=(b=this.className+"-"+a.type)?b:"info"),this.$el.text(a.message),null!=a.timeout&&setTimeout(function(a){return function(){return a.remove()}}(this),a.timeout),this},b.prototype.render=function(){return q(function(a){return function(){return a.$el.addClass("show")}}(this)),this},b.prototype.remove=function(){return this.$el.one(p,function(a){return function(){return b.__super__.remove.apply(a,arguments)}}(this)),this.$el.removeClass("show"),this},b}(Backbone.View),h=function(){function a(){}return a.prototype.create=function(a,b){var c;return c=this[a],null!=c?new c(b):(console.error("Failed to resolve "+a+"."),null)},a}(),$.extend(e,{Fields:{},Columns:{},Filters:{},formatters:new h,getHistoryRoot:function(){return this.baseUrl.substr(this.root.length)},getApp:function(){return this.app||(this.app=(new c).init()),this.app},ready:function(a){return this.getApp().ready(a)}}),e.View=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.componentId=function(a){return this.cid+"-"+a},b.prototype.$component=function(a){return this.$("#"+this.componentId(a))},b}(Backbone.View),a=function(){function a(a){this.original=new FormData,null!=a&&this.append(a)}return a.prototype.append=function(a,b){var c,d,e,f;if(void 0===b&&(b=a,a=null),b instanceof File||b instanceof Blob)return this.original.append(a,b);if(_.isArray(b)){if(_.isEmpty(b))return this.append(a,"");for(c=d=0,e=b.length;e>d;c=++d)f=b[c],this.append(this.key(a,c),f)}else{if(!_.isObject(b))return this.original.append(a,this.process(b));if(_.isFunction(b.serialize))this.append(a,b.serialize());else for(c in b)f=b[c],this.append(this.key(a,c),f)}},a.prototype.process=function(a){return null===a?"":a===!0?1:a===!1?0:a},a.prototype.key=function(a,b){return a?""+a+"["+b+"]":b},a}(),e.Attribute=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){return this.entity=a.entity,this},b.prototype.getType=function(){return this.attributes.type},b.prototype.getHelp=function(){return this.attributes.help},b.prototype.isVisible=function(){return this.attributes.hide===!1},b}(Backbone.Model),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.defaults={data:[],search:""},b.prototype.initialize=function(a,b){var c,d;return this.entity=c=b.entity,this.filter=d=new Backbone.Model,this.options={url:c.url(),dataType:"json",type:"get",displayLoading:!0,success:function(a){return function(b){return a._hold=!0,a.set(b),a._hold=!1,a.trigger("data",a,b.data)}}(this),error:function(a){return function(b){return a.trigger("error",a,b)}}(this)},this.listenTo(d,"change",function(a){return function(){return a.set({current_page:1,silent:!0}),a.fetch()}}(this)),this.on("change",function(a){return function(){return a._hold?void 0:a.fetch()}}(this)),this.on("change:search",function(a){return function(){return a._hold?void 0:a.set({current_page:1,silent:!0})}}(this))},b.prototype.hasData=function(){return!_.isEmpty(this.get("data"))},b.prototype.hasMore=function(){return this.get("current_page")<this.get("last_page")},b.prototype.isFull=function(){return!this.hasMore()},b.prototype.inProgress=function(){return null!=this.request},b.prototype.holdFetch=function(){return this._hold=!0,this},b.prototype.fetch=function(){return this._hold=!1,null!=this.request&&this.request.abort(),this.options.data=this.data(),this.request=$.ajax(this.options),this.request.always(function(a){return function(){return a.request=null}}(this)),this.trigger("request",this,this.request),this.request},b.prototype.more=function(){return this.isFull()?void 0:(this.set({current_page:this.get("current_page")+1,silent:!0}),this.fetch())},b.prototype.data=function(){var a,b;return a={order_by:this.get("order_by"),order_dir:this.get("order_dir"),page:this.get("current_page"),per_page:this.get("per_page"),keywords:this.get("search")},b=this.filterData(),_.isEmpty(b)||(a.filters=b),null!=this.columns&&(a.columns=this.columns.join(",")),a},b.prototype.filterData=function(){var a,b,c,d;a={},d=this.filter.attributes;for(b in d)c=d[b],""!==c&&null!==c&&(a[b]=c);return a},b}(Backbone.Model),n=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.defaults={keywords:null,constraint:null},b.prototype.initialize=function(a,b){return this.resetData=!1,this.needsRefresh=!1,this.data=[],this.page=null,this.more=!0,this.options={url:b.url,type:"get",dataType:"json",data:{simple:1},success:function(a){return function(b){var c,d,e,f;for(a.resetData&&(a.data=[]),f=b.data,d=0,e=f.length;e>d;d++)c=f[d],a.data.push(c);return a.page=b.current_page,a.more=b.current_page<b.last_page,a.request=null,a.trigger("data",a,a.data),a}}(this),error:function(a){return function(b){return a.request=null,a.trigger("error",a,b),a}}(this)},null!=b.ajaxOptions&&$.extend(!0,this.options,b.ajaxOptions),this.on("change",this.refresh,this),this},b.prototype.refresh=function(){return this.resetData=!0,this.fetchPage(1)},b.prototype.fetchPage=function(a){return null!=this.request&&this.request.abort(),$.extend(this.options.data,this.attributes,{page:a}),this.trigger("request",this,this.request=$.ajax(this.options)),this.request},b.prototype.next=function(){return this.fetchPage(null!=this.page?this.page+1:this.more?1:void 0),this},b.prototype.inProgress=function(){return null!=this.request},b.prototype.isEmpty=function(){return null===this.page&&!this.request},b.prototype.getById=function(a){return a.length||(a=a.toString()),_.find(this.data,function(b){return b.id.toString()===a})},b}(Backbone.Model),l=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="ul",b.prototype.className="pager",b.prototype.events={"click a":"navigate"},b.prototype.initialize=function(){var a;return a=e.router,this.listenTo(this.model,"data",this.render),this.listenTo(this.model,"request",this.disable),$(document).on("keydown.pagination",$.proxy(this,"hotkeys")),this},b.prototype.hotkeys=function(a){return a.ctrlKey&&37===a.keyCode?(this.previous(),!1):a.ctrlKey&&39===a.keyCode?(this.next(),!1):this},b.prototype.page=function(a){return a>0&&a<=this.model.get("last_page")&&this.model.set("current_page",a),this},b.prototype.previous=function(){return this.page(this.model.get("current_page")-1)},b.prototype.next=function(){return this.page(this.model.get("current_page")+1)},b.prototype.navigate=function(a){return a.preventDefault(),this.model.inProgress()?void 0:this.page($(a.target).data("page"))},b.prototype.disable=function(){return this.$("a").addClass("disabled"),this},b.prototype.render=function(){var a;return a=this.model.get("last_page"),this.$el.toggle(null!=a&&a>1),a>1&&this.$el.html(this.template(this.model.get("current_page"),a)),this},b.prototype.template=function(a,b){var c;return c="",c+=this.renderLink(a-1,"&larr; "+e.lang.prev,"previous"+(a>1?"":" disabled")),null!=this.model.get("total")&&(c+=this.renderStats()),c+=this.renderLink(a+1,""+e.lang.next+" &rarr;","next"+(b>a?"":" disabled"))},b.prototype.renderStats=function(){return'<li class="stats"><span>'+this.model.get("from")+" - "+this.model.get("to")+" / "+this.model.get("total")+"</span></li>"},b.prototype.renderLink=function(a,b,c){return null==c&&(c=""),'<li class="'+c+'"><a href="#" data-page="'+a+'">'+b+"</a></li>"},b}(Backbone.View),f=function(a){function b(a){this.className+=" dg-"+a.entity.id,b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="table",b.prototype.className="table table-hover dg",b.prototype.events={"click .col__sortable":"setOrder","click [data-action]":"executeAction"},b.prototype.initialize=function(a){return this.entity=a.entity,this.columns=this.entity.columns.models.filter(function(a){return a.isVisible()}),this.addActionColumns(this.columns),this.listenTo(this.model,"data",function(a){return function(){return a.renderBody()}}(this)),this.listenTo(this.model,"change:order_by change:order_dir",this.markOrderColumn),this.listenTo(this.entity,"change:instance",this.markActiveItem)},b.prototype.addActionColumns=function(){return this.columns.unshift(new e.Columns.ViewButton({entity:this.entity})),this.entity.deletePermitted()&&this.columns.push(new e.Columns.DeleteButton({entity:this.entity})),this},b.prototype.markOrderColumn=function(){var a,b;return a=this.model.get("order_by"),b=this.model.get("order_dir")||"asc",null!=this.orderBy&&a!==this.orderBy&&this.$colCell(this.orderBy).removeClass("asc desc"),this.$colCell(this.orderBy=a).removeClass("asc desc").addClass(b),this},b.prototype.markActiveItem=function(){var a;return(a=this.entity.previous("instance"))&&this.$itemRow(a).removeClass("active"),(a=this.entity.get("instance"))&&this.$itemRow(a).addClass("active"),this},b.prototype.setOrder=function(a){var b,c;return b=$(a.target).data("id"),c=this.model.get("order_dir"),c=b===this.model.get("order_by")?"asc"===c?"desc":"asc":this.entity.columns.get(b).get("order_dir"),this.model.set({order_by:b,order_dir:c}),this},b.prototype.render=function(){return this.$el.html(this.template()),this.$header=this.$component("header"),this.$items=this.$component("items"),this.renderHead(),this.renderBody(),this},b.prototype.renderHead=function(){var a,b,c,d,e;for(b="",e=this.columns,c=0,d=e.length;d>c;c++)a=e[c],b+=this.renderHeadCell(a);return this.$header.html(b),this.markOrderColumn()},b.prototype.renderHeadCell=function(a){return'<th class="'+a.getClass()+'" id="'+this.colCellId(a)+'" data-id="'+a.id+'">\n    '+this.renderHeadCellValue(a)+"\n</th>"},b.prototype.renderHeadCellValue=function(a){var b,c;return c=_.escape(a.getHeader()),(b=_.escape(a.getHelp()))&&(c='<span class="glyphicon glyphicon-question-sign" title="'+b+'"></span> '+c),c},b.prototype.renderBody=function(){var a,b,c,d,e;if(!this.model.hasData())return this.$items.html(this.emptyTemplate()),this;for(a="",e=this.model.get("data"),c=0,d=e.length;d>c;c++)b=e[c],a+=this.renderRow(b);return this.$items.html(a),this.markActiveItem()},b.prototype.renderRow=function(a){var b,c,d,e,f;for(c='<tr class="item '+this.itemStates(a)+'" id="'+this.itemRowId(a)+'" data-id="'+a.id+'">',f=this.columns,d=0,e=f.length;e>d;d++)b=f[d],c+=this.renderCell(b,a);return c+="</tr>"},b.prototype.itemStates=function(a){var b,c;return c=a._states?a._states:"",null!=(b=this.entity.get("instance"))&&a.id===b.id&&(c+=" active"),c},b.prototype.renderCell=function(a,b){return'<td class="'+a.getClass()+'">\n    '+a.render(b)+"\n</td>"},b.prototype.executeAction=function(a){var b,c;b=$(a.currentTarget),c=b.data("action"),c&&(c=this[c])&&(a.preventDefault(),c.call(this,b))},b.prototype.deleteItem=function(a){var b;confirm(e.lang.confirm_delete)&&(b=a.closest(".item"),a.attr("disabled",!0),this.entity.destroy(b.data("id"),{displayLoading:!0,success:function(a){return function(){return b.fadeOut(),a.model.fetch()}}(this),fail:function(){return a.attr("disabled",!1)}}))},b.prototype.template=function(){return'<thead><tr id="'+this.componentId("header")+'"></tr></thead>\n<tbody class="items" id="'+this.componentId("items")+'"></tbody>'},b.prototype.emptyTemplate=function(){return'<tr class="empty">\n    <td colspan="'+this.columns.length+'">\n        '+e.lang.no_results+"\n    </td>\n</tr>"},b.prototype.colCellId=function(a){return this.componentId("col-"+a.id)},b.prototype.$colCell=function(a){return this.$component("col-"+a)},b.prototype.itemRowId=function(a){return this.componentId("item-"+a.id)},b.prototype.$itemRow=function(a){return this.$component("item-"+a.id)},b}(e.View),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="filter-list",b.prototype.tagName="fieldset",b.prototype.events={"click .btn-apply":"apply","click .btn-reset":"reset"},b.prototype.initialize=function(a){return this.entity=a.entity,this.availableFilters=a.filters,this.filterModel=new Backbone.Model,this.listenTo(this.model,"change",function(a){return this.filterModel.set(a.attributes)}),this},b.prototype.apply=function(){return this.model.set(this.filterModel.attributes),this},b.prototype.reset=function(){var a,b,c,d;for(d=this.filters,b=0,c=d.length;c>b;b++)a=d[b],a.empty();return this.apply()},b.prototype.render=function(){var a,b,c,d,e;for(this.dispose(),this.$el.html(this.template()),this.items=this.$(".filter-list-container"),e=this.availableFilters.models,c=0,d=e.length;d>c;c++)a=e[c],this.filters.push(b=a.createFilterInput(this.filterModel)),this.items.append(b.render().el),b.$el.wrap('<div class="form-group '+a.getClass()+'"></div>').parent().before("<label>"+a.getLabel()+"</label>");return this},b.prototype.template=function(){return'<div class="filter-list-container"></div>\n<button type="button" class="btn btn-primary btn-apply">'+e.lang.filter_apply+'</button>\n<button type="button" class="btn btn-default btn-reset">'+e.lang.filter_reset+"</button>"},b.prototype.dispose=function(){var a,b,c,d;if(null!=this.filters)for(d=this.filters,b=0,c=d.length;c>b;b++)a=d[b],a.remove();return this.filters=[],this},b.prototype.remove=function(){return this.dispose(),b.__super__.remove.apply(this,arguments)},b}(Backbone.View),e.Inputs={},e.Inputs.Base=function(a){function b(a){this.key=a.key,b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(){return this.listenTo(this.model,"change:"+this.key,function(a,b,c){return this.applyChanges(b,!c.input||c.input!==this)}),this},b.prototype.applyChanges=function(){return this},b.prototype.render=function(){return this.applyChanges(this.getValue(),!0)},b.prototype.focus=function(){return this},b.prototype.getValue=function(){return this.model.get(this.key)},b.prototype.setValue=function(a,b){return null==b&&(b={}),b.input=this,this.model.set(this.key,a,b),this},b.prototype.emptyValue=function(){return null},b.prototype.empty=function(){return this.model.set(this.key,this.emptyValue())},b}(e.View),e.Inputs.Static=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="p",b.prototype.className="form-control-static",b.prototype.initialize=function(a){return null!=a.formatter&&(this.formatter=a.formatter),b.__super__.initialize.apply(this,arguments)},b.prototype.applyChanges=function(){return this.render()},b.prototype.render=function(){var a;return a=this.getValue(),null!=this.formatter&&(a=this.formatter.format(a)),this.$el.html(a),this},b}(e.Inputs.Base),e.Inputs.BaseText=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="form-control",b.prototype.events={change:"change",keydown:"keydown"},b.prototype.keydown=function(a){return a.ctrlKey&&13===a.keyCode?this.change():this},b.prototype.disable=function(){return this.$el.prop("disabled",!0),this},b.prototype.enable=function(){return this.$el.prop("disabled",!1),this},b.prototype.change=function(){return this.setValue(this.el.value)},b.prototype.applyChanges=function(a,b){return b&&this.$el.val(a),this},b.prototype.focus=function(){return this.el.focus(),this},b}(e.Inputs.Base),e.Inputs.Text=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="input",b.prototype.initialize=function(a){return a.mask&&this.$el.mask(a.mask),b.__super__.initialize.apply(this,arguments)},b}(e.Inputs.BaseText),e.Inputs.Textarea=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="textarea",b}(e.Inputs.BaseText),e.Inputs.Checkbox=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="label",b.prototype.label="",b.prototype.events={change:"change"},b.prototype.initialize=function(a){return null!=a.label&&(this.label=a.label),b.__super__.initialize.apply(this,arguments)},b.prototype.change=function(){return this.setValue(this.input.prop("checked"))},b.prototype.applyChanges=function(a,b){return b&&this.input.prop("checked",a),this},b.prototype.render=function(){return this.input=$("<input>",{type:"checkbox",checked:this.getValue()}),this.$el.append(this.input),null!=this.label&&this.$el.append(this.label),this},b}(e.Inputs.Base),e.Inputs.Boolean=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.events={"click .btn":"check"},b.prototype.initialize=function(a){var c;return this.tripleState=null!=(c=a.tripleState)?c:!1,b.__super__.initialize.apply(this,arguments)},b.prototype.check=function(a){var b,c;return c=!!$(a.target).data("value"),b=this.model.get(this.key),c===b&&this.tripleState&&(c=null),this.setValue(c)},b.prototype.applyChanges=function(a){return a=function(){switch(a){case!0:return 0;case!1:return 1;default:return null}}(),this.values.removeClass("active"),null!=a&&this.values.eq(a).addClass("active"),this},b.prototype.render=function(){return this.$el.html(this.template()),this.values=this.$(".btn"),b.__super__.render.apply(this,arguments)},b.prototype.template=function(){return'<div class="btn-group">\n    <button type="button" class="btn btn-default" data-value="1">'+e.lang.yes+'</button>\n    <button type="button" class="btn btn-default" data-value="0">'+e.lang.no+"</button>\n</div>"},b.prototype.focus=function(){var a;return null!=(a=this.values)&&a[0].focus(),this},b}(e.Inputs.Base),e.Inputs.EntityDropdown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="entity-dropdown",b.prototype.events={"click .ed-item>.input-group-btn>.btn-remove":"removeItem","click .ed-item>.input-group-btn>.btn-edit":"editItem","click .ed-item>.form-control":"executeFirstAction","keydown .ed-item>.form-control":"itemKeydown","keydown [type=search]":"searchKeydown","show.bs.dropdown":"renderDropdown","shown.bs.dropdown":function(){return q(function(a){return function(){return a.selector.focus()}}(this)),this},"hide.bs.dropdown":function(a){this.executingFirstAction&&a.preventDefault()},"hidden.bs.dropdown":function(){return this.opened=!1,this}},b.prototype.initialize=function(a){var c,d,f;return null!=a.multiple&&(this.multiple=a.multiple),null!=a.reference&&(this.reference=a.reference),null!=a.owner&&(this.owner=a.owner),this.allowEdit=(null!=(c=a.allowEdit)?c:!0)&&this.reference.updatePermitted(),this.placeholder=null!=(d=a.placeholder)?d:e.lang.not_selected,this.enabled=null!=(f=a.enabled)?f:!0,this.editing=!1,this.disableDropdown=!1,this.opened=!1,a.constraint&&(this.constraint=a.constraint,this.listenTo(this.model,"change:"+this.constraint.field,function(){return this.checkToDisable().applyConstraint(!0)})),b.__super__.initialize.apply(this,arguments)},b.prototype.getKey=function(a){return $(a.currentTarget).closest(".ed-item").data("key")},b.prototype.removeItem=function(a){var b,c;return this.multiple?(b=this.getKey(a),c=_.clone(this.model.get(this.key)),c.splice(b,1)):c=null,this.setValue(c)},b.prototype.executeFirstAction=function(a){return $(".btn:not(:disabled):last",$(a.currentTarget).next()).trigger("click"),!1},b.prototype.editItem=function(a){var b,c;if(!this.editing&&this.allowEdit&&(c=this.model.get(this.key),this.multiple&&(c=c[this.getKey(a)]),c))return b=$(a.currentTarget),b.is(".form-control")&&(b=b.next().children(".btn-edit")),b.prop("disabled",!0),this.editing=this.reference.load(c.id).done(function(c){return function(d){var f;return c.editingForm=f=e.Entity.Form.display(d),f.once("saved",function(a){return b.parent().siblings("input").val(a.title),f.remove()}),f.once("destroyed",function(){return c.removeItem(a)}),f.once("remove",function(){return c.editingForm=null})}}(this)),this.editing.always(function(a){return function(){return a.editing=null,b.prop("disabled",!1)}}(this)),this},b.prototype.searchKeydown=function(a){return 27===a.keyCode?(this.$el.dropdown("toggle"),!1):void 0},b.prototype.itemKeydown=function(a){return 13===a.keyCode?(this.executeFirstAction(a),!1):void 0},b.prototype.applyConstraint=function(a){var b,c;return null==a&&(a=!1),this.selector&&(b=this.model.get(this.constraint.field),null!=(c=this.selector.dataSource)&&c.set("constraint",b),this.selector.attributesForNewModel[this.constraint.otherField]=b),a&&this.model.set(this.key,this.multiple?[]:null),this},b.prototype.checkToDisable=function(){return!this.enabled||this.constraint&&_.isEmpty(this.model.get(this.constraint.field))?this.disable():this.enable(),this},b.prototype.disable=function(){return this.disableDropdown?this:(this.disableDropdown=!0,this.toggleDisableControls())},b.prototype.enable=function(){return this.disableDropdown?(this.disableDropdown=!1,this.toggleDisableControls()):this},b.prototype.toggleDisableControls=function(){return this.dropdownBtn.prop("disabled",this.disableDropdown),this.$el.toggleClass("disabled",this.disableDropdown),this},b.prototype.renderDropdown=function(a){return this.disableDropdown?void a.preventDefault():(this.opened=!0,this.selector||(this.selector=new e.Inputs.EntitySelector({model:this.model,key:this.key,multiple:this.multiple,reference:this.reference,allowCreate:this.allowEdit,owner:this.owner}),this.constraint&&this.applyConstraint(),this.$el.append(this.selector.render().el)),void this.toggleOpenDirection())},b.prototype.toggleOpenDirection=function(){var a,b,c;if(this.opened)return c=$(window),a=c.height()-this.$el.offset().top-c.scrollTop()-this.$el.parent(".field-list").scrollTop(),b=a>292?"open-down":"open-up",this.$el.hasClass(b)||this.$el.removeClass("open-up open-down").addClass(b),this},b.prototype.applyChanges=function(){return this.multiple?this.renderItems():(this.updateItem(),this.$el.removeClass("open")),this.toggleOpenDirection(),this},b.prototype.render=function(){return this.dispose(),this.multiple?this.renderMultiple():this.renderSingle(),this.dropdownBtn=this.$("#"+this.cid+"-dropdown"),this.$el.attr("id",this.cid),this.checkToDisable(),this},b.prototype.renderMultiple=function(){return this.$el.append(this.items=$("<div>",{"class":"items"})),this.enabled&&this.$el.append('<button type="button" class="btn btn-default btn-block dropdown-toggle ed-dropdown-toggle" data-toggle="dropdown" id="'+this.cid+'-dropdown" data-target="#'+this.cid+'">\n    '+e.lang.choose+'\n    <span class="caret"></span>\n</button>'),this.renderItems()},b.prototype.renderItems=function(){var a,b,c,d,e,f;for(a="",f=this.getValue(),b=d=0,e=f.length;e>d;b=++d)c=f[b],a+=this.itemTemplate(c.title,b);return this.items.html(a),this.items.toggleClass("has-items",""!==a),this},b.prototype.renderSingle=function(){return this.$el.html(this.itemTemplate("","0")),this.itemTitle=this.$(".form-control"),this.itemDelete=this.$(".btn-remove"),this.itemEdit=this.$(".btn-edit"),this.updateItem()},b.prototype.updateItem=function(){var a;return a=this.getValue(),this.itemTitle.val(a?a.title:""),this.itemDelete.toggle(!!a),this.itemEdit.toggle(!!a),this},b.prototype.itemTemplate=function(a,b){var c,d;return null==b&&(b=null),d='<div class="input-group ed-item '+(this.multiple?"":"ed-dropdown-toggle")+'" data-key="'+b+'">\n    <input type="text" class="form-control" '+(this.multiple?"tab-index='-1'":"placeholder='"+this.placeholder+"'")+' value="'+_.escape(a)+'" readonly>',_.isEmpty(c=this.buttonsTemplate())||(d+='<div class="input-group-btn">\n    '+c+"\n</div>"),d+="</div>"},b.prototype.buttonsTemplate=function(){var a;return a="",this.enabled&&(a+='<button type="button" class="btn btn-default btn-remove" tabindex="-1">\n    <span class="glyphicon glyphicon-remove"></span>\n</button>'),this.allowEdit&&(a+='<button type="button" class="btn btn-default btn-edit" tabindex="-1">\n    <span class="glyphicon glyphicon-pencil"></span>\n</button>'),this.multiple||(a+='<button type="button" class="btn btn-default btn-dropdown dropdown-toggle" data-toggle="dropdown" id="'+this.cid+'-dropdown" data-target="#'+this.cid+'" tab-index="1">\n    <span class="glyphicon glyphicon-search"></span>\n</button>'),a},b.prototype.focus=function(){var a;return a=this.$component("dropdown"),this.multiple||(a=a.parent().prev()),a[0].focus(),_.isEmpty(this.getValue())&&a.trigger("click"),this},b.prototype.emptyValue=function(){return this.multiple?[]:null},b.prototype.dispose=function(){var a,b;return null!=(a=this.selector)&&a.remove(),null!=(b=this.editingForm)&&b.remove(),this},b.prototype.remove=function(){return this.dispose(),b.__super__.remove.apply(this,arguments)},b}(e.Inputs.Base),e.Inputs.EntitySelector=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="entity-selector",b.prototype.events={"click .items>.item":"checkItem","click .more":"loadMore","click .btn-add":"showNewForm","click .btn-refresh":"refresh","click [type=search]":function(){return!1}},b.prototype.initialize=function(a){var c,d,e,f;return b.__super__.initialize.apply(this,arguments),this.filter=null!=(c=a.filter)?c:!1,this.multiple=null!=(d=a.multiple)?d:!1,this.reference=a.reference,this.allowSearch=null!=(e=a.allowSearch)?e:!0,this.allowCreate=(null!=(f=a.allowCreate)?f:!0)&&this.reference.createPermitted(),this.attributesForNewModel={},this.makeSelectedMap(this.getValue()),this.reference.viewPermitted()&&(this.primaryKey="id",this.dataSource=this.reference.search({ajaxOptions:{data:{owner:a.owner}}}),this.listenTo(this.dataSource,"request",this.displayLoading),this.listenTo(this.dataSource,"data",this.renderItems)),this},b.prototype.displayLoading=function(a,b){return this.$el.addClass("loading"),b.always(function(a){return function(){return a.$el.removeClass("loading")}}(this)),this},b.prototype.maybeLoadMore=function(){return null!=this.$more&&this.items.parent().height()+50>this.$more.position().top&&this.loadMore(),this},b.prototype.refresh=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.dataSource.refresh()},b.prototype.checkItem=function(a){a.preventDefault(),a.stopPropagation(),this.selectItem(this.dataSource.getById($(a.target).data("id")))},b.prototype.selectItem=function(a){var b;if(a)return this.multiple?a.id in this.selected?b=_.filter(this.model.get(this.key),function(a){return a.id!==id}):(b=_.clone(this.model.get(this.key)),b.push(a)):b=a,this.setValue(b)},b.prototype.loadMore=function(){return this.dataSource&&!this.dataSource.inProgress()?(this.dataSource.next(),!1):void 0},b.prototype.showNewForm=function(a){var b,c;return a&&(a.preventDefault(),a.stopPropagation()),this.newModelForm?void 0:(c=this.reference.createInstance({attributes:this.attributesForNewModel}),this.newModelForm=b=e.Entity.Form.display(c),b.once("remove",function(a){return function(){return a.newModelForm=null}}(this)),b.once("created",function(a){return function(c){a.selectItem({id:c.id,title:c.title}),b.remove()}}(this)),this)},b.prototype.applyChanges=function(a){return this.makeSelectedMap(a),this.renderItems()},b.prototype.makeSelectedMap=function(a){var b,c,d;if(this.selected={},this.multiple)for(c=0,d=a.length;d>c;c++)b=a[c],this.selected[b.id]=!0;else null!=a&&(this.selected[a.id]=!0);return this},b.prototype.renderItems=function(){var a,b,c,d,f;if(this.$more=null,a="",this.dataSource.data.length||this.dataSource.more){for(f=this.dataSource.data,c=0,d=f.length;d>c;c++)b=f[c],a+=this.renderItem(b);this.dataSource.more&&(a+='<li class="more">'+e.lang.more+"</li>")}else a+='<li class="empty">'+e.lang.no_results+"</li>";return this.items.html(a),this.dataSource.more&&(this.$more=this.items.children(".more"),this.maybeLoadMore()),this},b.prototype.renderItem=function(a){var b;return b=a.id in this.selected?"selected":"",'<li class="item '+b+'" data-id="'+a.id+'">'+a.title+"</li>"},b.prototype.render=function(){return this.reference.viewPermitted()?(this.dispose(),this.$el.html(this.template()),this.items=this.$(".items"),this.renderItems(),this.items.parent().on("scroll",$.proxy(this,"maybeLoadMore")),this.allowSearch&&this.renderSearch(),this.dataSource.isEmpty()&&this.dataSource.refresh()):this.$el.html("<span class=error>"+e.lang.forbidden+"</span>"),this},b.prototype.renderSearch=function(){return this.searchInput=new e.Inputs.Search({model:this.dataSource,key:"keywords"}),this.$el.prepend(this.searchInput.render().$el),this.searchInput.$el.wrap("<div class=search-input-container></div>"),this.searchInput.appendButton('<button type="button" class="btn btn-default btn-refresh" tabindex="-1">\n    <span class="glyphicon glyphicon-refresh"></span>\n</button>'),this.allowCreate&&this.searchInput.appendButton("<button type=\"button\" class='btn btn-default btn-add' tabindex='-1'>\n    <span class='glyphicon glyphicon-plus'></span>\n</button>"),this},b.prototype.template=function(){return'<div class="items-container"><ul class="items"></ul></div>'},b.prototype.focus=function(){var a;return(null!=(a=this.searchInput)?a.focus():void 0)||this.entity.done(function(a){return function(){return a.searchInput.focus()}}(this)),this},b.prototype.dispose=function(){var a,b;return null!=(a=this.searchInput)&&a.remove(),null!=(b=this.newModelForm)&&b.remove(),this},b.prototype.remove=function(){return this.dispose(),b.__super__.remove.apply(this,arguments)},b}(e.Inputs.Base),e.Inputs.FileList=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="file-list",b.prototype.events={"change [type=file]":"appendFiles","click .action-delete":"deleteFile"},b.prototype.initialize=function(a){var c,d,e;return this.multiple=null!=(c=a.multiple)?c:!1,this.formatter=null!=(d=a.formatter)?d:{format:function(a){return a instanceof File?a.name:a}},this.accepts=null!=(e=a.accepts)?e:"",this.counter=1,b.__super__.initialize.apply(this,arguments)},b.prototype.deleteFile=function(a){var b;return this.multiple?(b=$(a.currentTarget).data("cid"),this.setValue(_.reject(this.getValue(),function(a){return function(c){return a.itemId(c)===b}}(this)))):this.setValue(null),!1},b.prototype.appendFiles=function(a){var b,c,d,e,f,g,h,i;if(0!==a.target.files.length){for(h=a.target.files,d=0,f=h.length;f>d;d++)b=h[d],b.cid=this.cid+"_"+this.counter++;if(this.multiple)for(c=_.clone(this.model.get(this.key)),i=a.target.files,e=0,g=i.length;g>e;e++)b=i[e],c.push(b);
else c=a.target.files[0];return this.setValue(c)}},b.prototype.applyChanges=function(){return this.render()},b.prototype.render=function(){var a,b,c,d,f,g;if(c=this.model.get(this.key),a="",c)for(g=this.multiple?c:[c],d=0,f=g.length;f>d;d++)b=g[d],a+=this.renderItem(b);return a.length&&(a=this.wrapItems(a)),a+=this.renderInput(this.multiple?"<span class='glyphicon glyphicon-plus'></span> "+e.lang.add:e.lang.choose),this.$el.html(a),this},b.prototype.wrapItems=function(a){return'<ul class="list-group">'+a+"</ul>"},b.prototype.renderInput=function(a){return'<div class="btn btn-sm btn-default file-list-input-wrap">\n    <input type="file" id="'+this.componentId("input")+'" accept="'+this.accepts+'"'+(this.multiple?" multiple":"")+">\n    "+a+"\n</div>"},b.prototype.renderItem=function(a){var b;return b=this.formatter.format(a),'<li class="list-group-item">\n    <a href="#" class="action-delete pull-right" data-cid="'+this.itemId(a)+'"><span class="glyphicon glyphicon-remove"></span></a>\n\n    '+b+"\n</li>"},b.prototype.itemId=function(a){return a instanceof File?a.cid:a},b.prototype.focus=function(){return this.$component("input")[0].focus(),this},b}(e.Inputs.Base),e.Inputs.ImageList=function(a){function b(){this.readers=[],b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="image-list",b.prototype.initialize=function(a){var c,d;return this.width=null!=(c=a.width)?c:0,this.height=null!=(d=a.height)?d:80,b.__super__.initialize.apply(this,arguments)},b.prototype.render=function(){var a,c,d,e;for(b.__super__.render.apply(this,arguments),e=this.readers,c=0,d=e.length;d>c;c++)a=e[c],a.readAsDataURL(a.item);return this.readers=[],this},b.prototype.wrapItems=function(a){return'<ul class="image-group">'+a+"</ul>"},b.prototype.renderItem=function(a){return'<li class="image-group-item">\n    '+this.renderImage(a)+'\n    <a href="#" class="action-delete" data-cid="'+this.itemId(a)+'"><span class="glyphicon glyphicon-remove"></span></a>\n</li>'},b.prototype.renderImage=function(a){var b,c;return(c=a instanceof File)?(b=a.data||"",null==a.data&&this.readers.push(this.createPreviewLoader(a))):b=w(a,this.width,this.height),'<a href="'+(c?a.data||"#":e.root+"/"+a)+'" class="img-wrap" data-trigger="fancybox">\n    <img src="'+b+'" '+(c?"id='"+a.cid+"'":"")+">\n</a>"},b.prototype.createPreviewLoader=function(a){var b;return b=new FileReader,b.item=a,b.onload=function(b){return b.target.item.data=b.target.result,$("#"+a.cid).attr("src",b.target.result).parent().attr("href",b.target.result)},b},b}(e.Inputs.FileList),e.Inputs.Search=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="input-group",b.prototype.events={"click .btn-search":"search"},b.prototype.initialize=function(a){return this.input=new e.Inputs.Text({model:this.model,key:a.key,attributes:{type:"search",placeholder:e.lang.search}}),b.__super__.initialize.apply(this,arguments)},b.prototype.search=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.input.change()},b.prototype.appendButton=function(a){return this.$btns.append(a)},b.prototype.render=function(){return this.$el.append(this.input.render().$el),this.$el.append(this.$btns=$('<div class="input-group-btn"></div>')),this.appendButton('<button type="button" class="btn btn-default btn-search">\n    <span class="glyphicon glyphicon-search"></span>\n</button>'),this},b.prototype.focus=function(){return this.input.focus(),this},b}(e.View),e.Inputs.Slug=function(a){function b(a){this.input=new e.Inputs.Text(_.clone(a)),null==a.className&&(a.className="input-group"),null!=a.attributes&&delete a.attributes,b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.events={"click .btn":"toggleSyncing"},b.prototype.initialize=function(a){var c,d,e;return c=null!=(d=a.chars)?d:"a-z0-9-_",this.regexp=new RegExp("[^"+c+"]+","g"),this.separator=null!=(e=a.separator)?e:"-",this.key=a.key,this.ref=_.isArray(a.ref)?a.ref:a.ref?[a.ref]:void 0,b.__super__.initialize.apply(this,arguments)},b.prototype.toggleSyncing=function(){return this.syncButton.hasClass("active")?this.unlink():this.link(),this},b.prototype.link=function(){return this.ref?(this.listenTo(this.model,"change:"+this.ref.join(" change:"),this.sync),this.syncButton.addClass("active"),this.input.disable(),this.sync()):void 0},b.prototype.unlink=function(){return null!=this.ref&&this.stopListening(this.model,null,this.sync),this.syncButton.removeClass("active"),this.input.enable(),this},b.prototype.linkable=function(){var a,b;return a=this.model.get(this.key),b=this.getValue(),b===a||null===a&&""===b},b.prototype.convert=function(a){return a?a.toLocaleLowerCase().replace(/\s+/g,this.separator).replace(this.regexp,""):a},b.prototype.sync=function(){return this.model.set(this.key,this.getValue()),this},b.prototype.getValue=function(){var a,b,c,d,e,f;for(a=[],f=this.ref,d=0,e=f.length;e>d;d++)b=f[d],c=this.model.get(b),c&&a.push(c);return a.length?this.convert(a.join(this.separator)):""},b.prototype.render=function(){return this.$el.html(this.template()),this.$el.prepend(this.input.render().el),null!=this.ref&&(this.syncButton=this.$(".btn"),this.linkable()&&this.link()),this},b.prototype.template=function(){return null==this.ref?"":'<div class="input-group-btn">\n    <button type="button" tabindex="-1" class="btn btn-default" title="'+e.lang.slug_sync+'"><span class="glyphicon glyphicon-link"></span></button>\n</div>'},b}(Backbone.View),e.Inputs.Select=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="select",b.prototype.initialize=function(a){var c,d,e;return this.items=null!=(c=a.items)?c:{},this.prompt=null!=(d=a.prompt)?d:null,this.required=null!=(e=a.required)?e:!1,b.__super__.initialize.apply(this,arguments)},b.prototype.applyChanges=function(a,b){return b&&this.$(":nth-child("+this.optionIndex(a)+")").prop("selected",!0),this},b.prototype.optionIndex=function(a){var b,c,d,e;c=this.hasPrompt()?2:1,e=this.items;for(b in e){if(d=e[b],a===b)break;c++}return c},b.prototype.render=function(){return this.$el.html(this.template()),this.required&&!this.getValue()&&this.setValue(this.$el.val()),b.__super__.render.apply(this,arguments)},b.prototype.template=function(){var a,b,c,d,f;a="",this.hasPrompt()&&(a+=this.optionTemplate("",null!=(d=this.prompt)?d:e.lang.not_selected,this.required)),f=this.items;for(b in f)c=f[b],a+=this.optionTemplate(b,c);return a},b.prototype.optionTemplate=function(a,b,c){return null==c&&(c=!1),'<option value="'+_.escape(a)+'"'+(c?" disabled":"")+">"+_.escape(b)+"</option>"},b.prototype.hasPrompt=function(){return!this.required||null!=this.prompt},b}(e.Inputs.Text),e.Inputs.Code=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){var c,d,f;return this.$el.height((null!=(d=a.height)?d:100)+"px"),this.editor=ace.edit(this.el),this.editor.setTheme("ace/theme/"+(null!=(f=a.theme)?f:e.ace_theme)),c=this.editor.getSession(),a.mode&&c.setMode("ace/mode/"+a.mode),c.setUseWrapMode(!0),c.setWrapLimitRange(null,null),b.__super__.initialize.apply(this,arguments)},b.prototype.applyChanges=function(a,b){return b&&(this.editor.setValue(a),this.editor.getSession().getSelection().clearSelection()),this},b.prototype.render=function(){return this.editor.on("blur",function(a){return function(){return a.model.set(a.key,a.editor.getValue(),{input:a})}}(this)),b.__super__.render.apply(this,arguments)},b.prototype.remove=function(){var a;return null!=(a=this.editor)&&a.destroy(),this.editor=null,b.__super__.remove.apply(this,arguments)},b.prototype.focus=function(){var a;return null!=(a=this.editor)&&a.focus(),this},b}(e.Inputs.Base),e.Inputs.Markdown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.events={"show.bs.tab [data-toggle=tab]":"showTab","shown.bs.tab [data-toggle=tab]":"shownTab"},b.prototype.initialize=function(a){var c;return this.height=null!=(c=a.height)?c:200,this.editorInput=new e.Inputs.Code({model:this.model,key:this.key,theme:a.theme,mode:"markdown",height:this.height}),b.__super__.initialize.apply(this,arguments)},b.prototype.showTab=function(a){return"preview"===$(a.target).data("tab")&&this.renderPreview(),this},b.prototype.shownTab=function(a){return"editor"===$(a.traget).data("tab")?this.editorInput.focus():void 0},b.prototype.render=function(){return this.$el.html(this.template()),this.$(".tab-pane-editor").append(this.editorInput.render().el),this.preview=this.$(".tab-pane-preview"),this},b.prototype.renderPreview=function(){return this.preview.html(marked(this.getValue())),this},b.prototype.template=function(){return'<div class="markdown-editor">\n    <a href="https://help.github.com/articles/github-flavored-markdown" target="_blank" class="hint">GitHub flavored markdown</a>\n\n    <ul class="nav nav-tabs">\n        <li class="active"><a href="#'+this.cid+'-editor" data-toggle="tab" data-tab="editor" tab-index="-1">'+e.lang.markdown_source+'</a></li>\n        <li><a href="#'+this.cid+'-preview" data-toggle="tab" data-tab="preview" tab-index="-1">'+e.lang.markdown_parsed+'</a></li>\n    </ul>\n\n    <div class="tab-content">\n        <div class="tab-pane-editor tab-pane active" id="'+this.cid+'-editor"></div>\n        <div class="tab-pane-preview tab-pane" id="'+this.cid+'-preview" style="height:'+this.height+'px"></div>\n    </div>\n</div>'},b.prototype.focus=function(){var a;return a=this.$("[data-tab=editor]"),a.hasClass("active")?this.editorInput.focus():a.tab("show"),this},b}(e.Inputs.Base),e.Inputs.NumberFilter=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="input-group number-filter",b.prototype.events={"click .dropdown-menu a":"changeOperator",change:"changeValue"},b.prototype.initialize=function(){return this.defaultOp="=",this.getValue()||this.setValue(this.emptyValue(),{silent:!0}),b.__super__.initialize.apply(this,arguments)},b.prototype.changeOperator=function(a){var b,c;return a.preventDefault(),b=$(a.currentTarget).data("op"),c=this.getValue(),c.op!==b&&this.setValue(this.makeValue(b,c.val)),this},b.prototype.changeValue=function(a){var b;return b=this.getValue(),this.setValue(this.makeValue(b.op,a.target.value)),this},b.prototype.applyChanges=function(a,b){return this.$(".dropdown-menu li").removeClass("active"),this.$(".dropdown-menu a[data-op='"+a.op+"']").parent().addClass("active"),this.op.text(a.op),b&&this.input.val(a.val),this},b.prototype.render=function(){return this.$el.html(this.template()),this.op=this.$component("op"),this.input=this.$component("input"),this.reset=this.$component("reset"),b.__super__.render.apply(this,arguments)},b.prototype.template=function(){return'<div class="input-group-btn">\n    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n        <span id="'+this.componentId("op")+'" class="value">=</span>\n        <span class="caret"></span>\n    </button>\n\n    <ul class="dropdown-menu">\n        <li><a href="#" data-op="=">=</a></li>\n        <li><a href="#" data-op="&gt;">&gt;</a></li>\n        <li><a href="#" data-op="&lt;">&lt;</a></li>\n    </ul>\n</div>\n\n<input type="text" class="form-control" id="'+this.componentId("input")+'">'},b.prototype.makeValue=function(a,b){return{op:a,val:b}},b.prototype.emptyValue=function(){return this.makeValue(this.defaultOp,"")},b}(e.Inputs.Base),e.Inputs.DateTime=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="input",b.prototype.initialize=function(a){return this.format=a.format,null!=a.mask&&this.$el.mask(a.mask),b.__super__.initialize.apply(this,arguments)},b.prototype.applyChanges=function(a,b){return this.$el.val(null===a?"":b?moment.unix(a).format(this.format):void 0),this},b.prototype.change=function(){var a;return a=this.$el.val(),a=_.isEmpty(a)?null:moment(a,this.format).unix(),this.setValue(a),this.applyChanges(a,!0)},b}(e.Inputs.BaseText),e.Layout={},e.Layout.Element=function(a){function b(a,c){var d;this.parent=c,this.disable=null!=(d=a.disable)?d:!1,b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(){return!this.model&&this.parent&&(this.model=this.parent.model),this.model&&(this.entity=this.model.entity),b.__super__.initialize.apply(this,arguments)},b.prototype.handleValidationError=function(a){return this.parent&&this.parent.handleValidationError(a),this},b.prototype.isDisabled=function(){return this.disable?!0:this.parent?this.parent.isDisabled():!1},b.prototype.isFocusable=function(){return!1},b.prototype.focus=function(){return this},b}(e.View),e.Layout.Container=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){return b.__super__.initialize.apply(this,arguments),this.$container=this.$el,this.items=[],a.items&&this.createItems(a.items),this},b.prototype.create=function(a){var b;return b=e.Layout[a["class"]],b&&_.isFunction(b)?this.append(new b(a,this)):void console.error("Couldn't resolve element of type ",method)},b.prototype.createItems=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.create(b);return this},b.prototype.append=function(a){return a&&this.items.push(a),a},b.prototype.renderElement=function(a){return this.$container.append(a.render().$el),this},b.prototype.render=function(){var a,c,d,e;if(this.items)for(e=this.items,c=0,d=e.length;d>c;c++)a=e[c],this.renderElement(a);return b.__super__.render.apply(this,arguments)},b.prototype.remove=function(){var a,c,d,e;for(e=this.items,c=0,d=e.length;d>c;c++)a=e[c],a.remove();return b.__super__.remove.apply(this,arguments)},b.prototype.getFocusable=function(){return _.find(this.items,function(a){return a.isFocusable()})},b.prototype.isFocusable=function(){return null!=this.getFocusable()},b.prototype.focus=function(){var a;return(a=this.getFocusable())&&a.focus(),this},b}(e.Layout.Element),e.Layout.BaseFieldContainer=function(a){function b(a){var c;this.title=null!=(c=a.title)?c:null,b.__super__.constructor.apply(this,arguments)}return z(b,a),b}(e.Layout.Container),e.Layout.Fieldset=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="fieldset",b.prototype.render=function(){return this.$el.html(this.template()),this.$container=this.$component("body"),b.__super__.render.apply(this,arguments)},b.prototype.template=function(){var a;return a=this.title?"<legend>"+_.escape(this.title)+"</legend>":"",a+"<div id='"+this.componentId("body")+"'></div>"},b}(e.Layout.BaseFieldContainer),e.Layout.TabPane=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="tab-pane",b.prototype.initialize=function(a){return b.__super__.initialize.apply(this,arguments),a.title||(this.title=this.entity.get("title").singular),this.$el.attr("id",this.cid),this.listenTo(this.model,"request",function(){return this.header?this.header.resetErrors():void 0}),this},b.prototype.activate=function(){var a;return null!=(a=this.header)&&a.activate(),q(function(a){return function(){return a.focus()}}(this)),this},b.prototype.getHeader=function(){return this.header||(this.header=new e.Layout.TabPane.Header({model:this})),this.header},b.prototype.handleValidationError=function(){var a;return null!=(a=this.header)&&a.incrementErrors(),b.__super__.handleValidationError.apply(this,arguments)},b}(e.Layout.BaseFieldContainer),e.Layout.TabPane.Header=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="li",b.prototype.events={"shown.bs.tab":function(){q(function(a){return function(){return a.model.focus()}}(this))}},b.prototype.initialize=function(){return this.errors=0,b.__super__.initialize.apply(this,arguments)},b.prototype.incrementErrors=function(){return this.$badge.text(++this.errors),this},b.prototype.resetErrors=function(){return this.errors=0,this.$badge.text(""),this},b.prototype.render=function(){return this.$el.html(this.template()),this.$badge=this.$component("badge"),b.__super__.render.apply(this,arguments)},b.prototype.template=function(){return'<a href="#'+this.model.cid+'" role="tab" data-toggle="tab">\n    '+this.model.title+'\n    <span class="badge" id="'+this.componentId("badge")+'"></span>\n</a>'},b.prototype.activate=function(){return this.$("a").tab("show"),this},b}(e.View),e.Layout.Row=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="row",b}(e.Layout.Container),e.Layout.Col=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){return this.$el.addClass("col-xs-"+a.span),b.__super__.initialize.apply(this,arguments)},b}(e.Layout.BaseFieldContainer),e.Layout.Field=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){return b.__super__.initialize.apply(this,arguments),this.fieldView=null,(this.field=this.entity.field(a.field))||console.error("The field "+a.field+" is not found in "+this.entity.id+"."),this},b.prototype.render=function(){return this.field&&this.field.isVisible()&&(this.fieldView=this.field.createView(this.model,this.isDisabled(),this)),this.fieldView&&this.$el.html(this.fieldView.render().$el),this},b.prototype.remove=function(){return this.fieldView&&this.fieldView.remove(),b.__super__.remove.apply(this,arguments)},b.prototype.isFocusable=function(){return this.fieldView&&this.fieldView.isFocusable()},b.prototype.focus=function(){return this.fieldView&&this.fieldView.focus(),this},b}(e.Layout.Element),e.Layout.Text=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.tagName="p",b.prototype.className="text-node",b.prototype.initialize=function(a){return a.contents&&this.$el.html(a.contents),b.__super__.initialize.apply(this,arguments)},b}(e.Layout.Element),i=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="field-list",b.prototype.initialize=function(){var a,c,d,e;for(b.__super__.initialize.apply(this,arguments),e=this.entity.fields.models,c=0,d=e.length;d>c;c++)a=e[c],this.create({"class":"Field",field:a.id});return this},b}(e.Layout.BaseFieldContainer),e.Layout.Layout=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(){return b.__super__.initialize.apply(this,arguments),this.setupLayout()},b.prototype.setupLayout=function(){return this.entity.attributes.layout?this.createItems(this.entity.attributes.layout):this.setupDefaultLayout(),this},b.prototype.setupDefaultLayout=function(){return this},b}(e.Layout.Container),e.Fields.BaseView=function(a){function b(a){var c,d,e,f;this.field=d=a.field,e=a.model,this.inputId=[e.entity.id,d.id,e.cid].join("__"),c="form-group field field__"+d.getType()+" field--"+d.id+" field--"+e.entity.id+"--"+d.id,this.className=this.className?c+" "+this.className:c,this.forceDisable=null!=(f=a.forceDisable)?f:!1,b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(){return this.listenTo(this.model,"sync",this.handleSync),this.listenTo(this.model,"request",this.handleRequest),this.listenTo(this.model,"invalid",this.handleInvalid),this.updateContainer()},b.prototype.handleSync=function(){return this.updateContainer()},b.prototype.handleRequest=function(){return this.hideError()},b.prototype.handleInvalid=function(a,b){var c;return this.field.id in b&&(c=b[this.field.id],this.showError(_.isArray(c)?_.first(c):c)),this},b.prototype.updateContainer=function(){return this.isEditable=!this.forceDisable&&this.field.isEditable(this.model),this.$el.toggle(this.isVisible()),this.$el.toggleClass("required",this.field.isRequired(this.model)),this},b.prototype.hideError=function(){return this.error.hide(),this},b.prototype.showError=function(a){return this.error.text(a).show(),this.handleValidationError(a),this},b.prototype.focus=function(){return this},b.prototype.render=function(){return this.$(".field-help").tooltip({container:"body",placement:"left"}),this.error=this.$component("error"),this},b.prototype.helpTemplate=function(){var a;return a=this.field.getHelp(),a?'<span class="glyphicon glyphicon-question-sign field-help" title="'+_.escape(a)+'"></span>':""},b.prototype.errorTemplate=function(){return'<span class="help-block error" style="display:none;" id="'+this.componentId("error")+'"></span>'},b.prototype.isVisible=function(){return this.isEditable||!this.model.isNew()},b.prototype.isFocusable=function(){return this.field.isEditable(this.model)},b.prototype.dispose=function(){return this},b.prototype.remove=function(){return this.dispose(),b.__super__.remove.apply(this,arguments)},b}(e.Layout.Element),e.Fields.InputView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.updateContainer=function(){var a;return a=this.isEditable,b.__super__.updateContainer.apply(this,arguments),null!=a&&a!==this.isEditable?this.render():void 0},b.prototype.hideError=function(){return this.$el.removeClass("has-error"),b.__super__.hideError.apply(this,arguments)},b.prototype.showError=function(){return this.$el.addClass("has-error"),b.__super__.showError.apply(this,arguments)},b.prototype.render=function(){return this.dispose(),this.$el.html(this.template()),this.input=this.field.createInput(this.model,this.inputId,this.forceDisable),this.$el.append(this.input.render().el),this.$el.append(this.errorTemplate()),b.__super__.render.apply(this,arguments)},b.prototype.label=function(a){return null==a&&(a=this.field.getLabel()),'<label for="'+this.inputId+'" class="field-label">\n    '+this.helpTemplate()+_.escape(a)+"\n</label>"},b.prototype.template=function(){return this.label()},b.prototype.focus=function(){return this.input.focus(),this},b.prototype.dispose=function(){var a;return null!=(a=this.input)&&a.remove(),this},b}(e.Fields.BaseView),e.Fields.Base=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.viewConstructor=e.Fields.InputView,b.prototype.createView=function(a,b,c){return null==b&&(b=!1),new this.viewConstructor({model:a,field:this,forceDisable:b},c)},b.prototype.createInput=function(a,b,c){var d;return null==c&&(c=!1),!c&&this.isEditable(a)&&(d=this.createEditableInput(a,b)),d||this.createStaticInput(a)},b.prototype.createStaticInput=function(a){return new e.Inputs.Static({model:a,key:this.id,formatter:this})},b.prototype.createEditableInput=function(){return null},b.prototype.createFilterInput=function(){return null},b.prototype.getFilterLabel=function(){return this.attributes.label},b.prototype.format=function(a){return a||k},b.prototype.getLabel=function(){return this.attributes.label},b.prototype.isEditable=function(a){return a.isSaveable()&&this.attributes.disabled!==!0&&this.attributes.disabled!==a.action()},b.prototype.isRequired=function(a){return this.attributes.required===!0||this.attributes.required===a.action()},b.prototype.isUnique=function(){return this.attributes.unique},b}(e.Attribute),e.Fields.Input=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a,b){var c;return c=this.createBaseInput(a,b),this.attributes.prepend||this.attributes.append?new e.Fields.Input.PrependAppendWrapper({prepend:this.attributes.prepend,append:this.attributes.append,input:c}):c},b.prototype.createBaseInput=function(a,b){return new e.Inputs.Text({model:a,key:this.id,mask:this.attributes.mask,attributes:{placeholder:this.attributes.placeholder,id:b,type:this.attributes.input_type||"input"}})},b.prototype.format=function(a){return null===a||""===a?k:(this.attributes.append&&(a+=" "+this.attributes.append),this.attributes.prepend&&(a=this.attributes.prepend+" "+a),a)},b}(e.Fields.Base),e.Fields.Input.PrependAppendWrapper=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="input-group",b.prototype.initialize=function(a){return a.prepend&&this.$el.append(this.createAddon(a.prepend)),this.$el.append((this.input=a.input).$el),a.append?this.$el.append(this.createAddon(a.append)):void 0},b.prototype.render=function(){return this.input.render(),this},b.prototype.createAddon=function(a){return"<span class=input-group-addon>"+_.escape(a)+"</span>"},b}(e.View),e.Fields.Text=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a,b){return new e.Inputs.Textarea({model:a,key:this.id,attributes:{placeholder:this.attributes.placeholder,id:b,rows:this.attributes.rows}})},b.prototype.format=function(a){return a?'<pre class="limit-height">'+a+"</pre>":k},b}(e.Fields.Base),e.Fields.BaseDateTime=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.inputFormat=null,b.prototype.mask=null,b.prototype.createEditableInput=function(a){return new e.Inputs.DateTime({model:a,key:this.id,format:this.inputFormat,mask:this.mask,attributes:{id:this.inputId}})},b.prototype.formatDate=function(a){return moment.unix(a).format(this.inputFormat)},b.prototype.format=function(a){return null===a?k:this.formatDate(a)},b}(e.Fields.Base),e.Fields.Date=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.inputFormat="YYYY-MM-DD",b.prototype.mask="9999-99-99",b}(e.Fields.BaseDateTime),e.Fields.Time=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.inputFormat="HH:mm:ss",b.prototype.mask="99:99:99",b}(e.Fields.BaseDateTime),e.Fields.DateTime=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.inputFormat="YYYY-MM-DD HH:mm:ss",b.prototype.mask="9999-99-99 99:99:99",b.prototype.formatDate=function(a){return moment.unix(a).fromNow()},b}(e.Fields.BaseDateTime),e.Fields.Boolean=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a){return new e.Inputs.Boolean({model:a,key:this.id})},b.prototype.createFilterInput=function(a){return new e.Inputs.Boolean({model:a,key:this.id,tripleState:!0})},b.prototype.format=function(a){return a?e.lang.yes:e.lang.no},b}(e.Fields.Base),e.Fields.BaseRelation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.isVisible=function(){return this.getReference().viewPermitted()&&b.__super__.isVisible.apply(this,arguments)},b.prototype.getReference=function(){return this.reference||(this.reference=e.app.entity(this.attributes.reference)),this.reference},b.prototype.getFilterLabel=function(){return this.getReference().getSingularTitle()},b.prototype.formatItem=function(a){return a.title},b.prototype.format=function(a){return _.isEmpty(a)?k:this.attributes.multiple?_.map(a,function(a){return function(b){return a.formatItem(b)}}(this)).join(", "):this.formatItem(a)},b}(e.Fields.Base),e.Fields.Relation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createInput=function(a,b,c){return null==c&&(c=!1),new e.Inputs.EntityDropdown({model:a,key:this.id,multiple:this.attributes.multiple,reference:this.getReference(),owner:this.entity.id+"."+this.id,constraint:this.attributes.constraint,enabled:!c&&this.isEditable(a)})},b.prototype.createFilterInput=function(a){return new e.Inputs.EntityDropdown({model:a,key:this.id,reference:this.getReference(),allowEdit:!1,placeholder:e.lang.any_value,owner:this.entity.id+"."+this.id,constraint:this.attributes.constraint})},b.prototype.isEditable=function(){return this.getReference().viewPermitted()&&b.__super__.isEditable.apply(this,arguments)},b.prototype.canFilter=function(){return this.getReference().viewPermitted()&&b.__super__.canFilter.apply(this,arguments)},b.prototype.formatItem=function(a){var b;return b=this.getReference(),b.viewPermitted()?'<a href="'+b.link(a.id)+'">'+_.escape(a.title)+"</a>":a.title},b}(e.Fields.BaseRelation),e.Fields.File=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a){return new e.Inputs.FileList({model:a,key:this.id,multiple:this.attributes.multiple,accepts:this.attributes.accepts})},b.prototype.format=function(a){return a instanceof b?a.name:a},b}(e.Fields.Base),e.Fields.Image=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a){return new e.Inputs.ImageList({model:a,key:this.id,width:this.attributes.width,height:this.attributes.height,multiple:this.attributes.multiple,accepts:this.attributes.accepts})},b.prototype.createStaticInput=function(a){return new e.Inputs.Static({model:a,key:this.id,formatter:new e.Fields.Image.Formatter({width:this.attributes.width,height:this.attributes.height})})},b}(e.Fields.File),e.Fields.Image.Formatter=function(){function a(a){this.options=a}return a.prototype.imageUrl=function(a){return e.root+"/"+a},a.prototype.imageThumb=function(a){return w(a,this.options.width,this.options.height)},a.prototype.format=function(a){var b,c,d,e;for(b='<ul class="image-group">',_.isArray(a)||(a=[a]),d=0,e=a.length;e>d;d++)c=a[d],b+='<li class="image-group-item">\n    <a href="'+this.imageUrl(c)+'" class="img-wrap" data-trigger="fancybox">\n        <img src="'+this.imageThumb(c)+'">\n    </a>\n</li>';return b+"</ul>"},a}(),e.Fields.Slug=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a){return new e.Inputs.Slug({model:a,key:this.id,chars:this.attributes.chars,ref:this.attributes.ref,separator:this.attributes.separator,attributes:{placeholder:this.attributes.placeholder}})},b}(e.Fields.Base),e.Fields.Enum=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createBaseInput=function(a,b){return new e.Inputs.Select({model:a,key:this.id,prompt:this.attributes.prompt,items:this.attributes.items,required:this.attributes.required,attributes:{id:b}})},b.prototype.createFilterInput=function(a){return new e.Inputs.Select({model:a,key:this.id,prompt:e.lang.any_value,items:this.attributes.items})},b.prototype.format=function(a){var b;return b=this.attributes.items,a in b?b[a]:k},b}(e.Fields.Input),e.Fields.Markdown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a){return new e.Inputs.Markdown({model:a,key:this.id,height:this.attributes.height,theme:this.attributes.theme})},b.prototype.format=function(a){return a?'<div class="well limit-height">'+marked(a)+"</div>":k},b}(e.Fields.Base),e.Fields.Code=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createEditableInput=function(a){return new e.Inputs.Code({model:a,key:this.id,height:this.attributes.height,mode:this.attributes.mode,theme:this.attributes.theme})},b.prototype.format=function(a){return a?'<div class="limit-height">'+a+"</div>":k},b}(e.Fields.Base),e.Fields.EmbeddedView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="has-many-view",b.prototype.events={"click .btn-create":"create"},b.prototype.initialize=function(){return this.views={},this.updateCollection(),b.__super__.initialize.apply(this,arguments)},b.prototype.updateCollection=function(){var a;return this.collection&&this.stopListening(this.collection),this.collection=a=this.model.get(this.field.id),this.listenTo(a,"add",this.add),this.listenTo(a,"remove",this.removeItem),this.listenTo(a,"removeSoftly restore",this.update),this
},b.prototype.handleSync=function(){return b.__super__.handleSync.apply(this,arguments),this.updateCollection(),this.render()},b.prototype.handleInvalid=function(a,c){return this.field.id in c&&c[this.field.id].length&&b.__super__.handleInvalid.apply(this,arguments),this},b.prototype.create=function(a){return a.preventDefault(),a.stopPropagation(),this.collection.add(this.field.getReference().createInstance(),{focus:!0}),this},b.prototype.add=function(a,b,c){var d,f;return d={model:a,collection:this.collection,disable:!this.isEditable},this.views[a.cid]=f=new e.Fields.EmbeddedItemView(d,this),this.body.append(f.render().el),(null!=c?c.focus:void 0)&&q(function(){return f.focus()}),this.focusable||(this.focusable=f),this.update(),this},b.prototype.removeItem=function(a){var b;return(b=this.views[a.cid])&&(b.remove(),delete this.views[a.cid]),this.update(),this},b.prototype.render=function(){var a,c,d,e;for(this.dispose(),this.$el.html(this.template()),this.body=this.$component("body"),this.createButton=this.$(".btn-create"),e=this.collection.models,c=0,d=e.length;d>c;c++)a=e[c],this.add(a);return b.__super__.render.apply(this,arguments)},b.prototype.update=function(){return this.createButton.toggle(this.field.isMultiple()||this.collection.hasSpots()),this},b.prototype.template=function(){var a;return a=this.canCreate()?r("","plus",["default","create"]):"","<div class='header field-label'>\n    "+this.helpTemplate()+_.escape(this.field.getLabel())+" "+a+'\n</div>\n<div class="error-container has-error">'+this.errorTemplate()+'</div>\n<div class="body" id="'+this.componentId("body")+'"></div>'},b.prototype.canCreate=function(){return this.isEditable&&this.field.getReference().createPermitted()},b.prototype.dispose=function(){var a,b,c;c=this.views;for(a in c)b=c[a],b.remove();return this.views={},this.focusable=null,this},b.prototype.remove=function(){return this.dispose(),b.__super__.remove.apply(this,arguments)},b.prototype.isFocusable=function(){return b.__super__.isFocusable.apply(this,arguments)?this.field.isMultiple()&&this.canCreate()||!this.field.isMultiple()&&null!=this.focusable:!1},b.prototype.focus=function(){var a,b;return this.field.isMultiple()?null!=(a=this.createButton[0])&&a.focus():null!=(b=this.focusable)&&b.focus(),this},b}(e.Fields.BaseView),e.Fields.EmbeddedItemView=function(a){function b(a){this.collection=a.collection,this.listenTo(this.collection,"restore removeSoftly",function(a){return a===this.model?(this.$container.toggle(!this.model.isDeleted),this.$btn.html(this.buttonContents())):void 0}),b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="has-many-item-view",b.prototype.events={"click .btn-toggle":"toggleItem"},b.prototype.toggleItem=function(){return this.model.isDeleted?this.collection.restore(this.model):this.collection.removeSoftly(this.model),!1},b.prototype.buttonContents=function(){return this.model.isDeleted?e.lang.restore:s("trash")+" "+e.lang["delete"]},b.prototype.setupDefaultLayout=function(){return this.append(new i({},this)),this},b.prototype.render=function(){return this.$el.html(this.template()),this.$container=this.$component("body"),this.$btn=this.$component("btn"),b.__super__.render.apply(this,arguments)},b.prototype.template=function(){var a;return a='<div id="'+this.componentId("body")+'"></div>',this.disabled||!this.model.entity.deletePermitted()&&!this.model.isNew()||(a+='<button type="button" class="btn btn-default btn-sm btn-toggle" id="'+this.componentId("btn")+'">\n    '+this.buttonContents()+"\n</button>"),a},b}(e.Layout.Layout),e.Fields.RelatedCollection=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a,c){return this.owner=c.owner,this.field=c.field,this.maxItems=c.maxItems,this.deleted=!1,this.removedSoftly=0,this.listenTo(this.owner,"sync",function(a){return function(){return a.deleted=!1}}(this)),b.__super__.initialize.apply(this,arguments)},b.prototype.add=function(){return this.maxItems&&this.models.length>=this.maxItems&&this.removeSoftDeleted(),b.__super__.add.apply(this,arguments)},b.prototype.removeSoftDeleted=function(){return this.remove(this.filter(function(a){return a.isDeleted}))},b.prototype.remove=function(a){var c,d,e;if(this.deleted=!0,_.isArray(a))for(d=0,e=a.length;e>d;d++)c=a[d],c.isDeleted&&this.removedSoftly--;else a.isDeleted&&this.removedSoftly--;return b.__super__.remove.apply(this,arguments)},b.prototype.removeSoftly=function(a){return a.isDeleted?void 0:(a.isDeleted=!0,this.removedSoftly++,this.trigger("removeSoftly",a),this)},b.prototype.restore=function(a){return a.isDeleted?(a.isDeleted=!1,this.removedSoftly--,this.trigger("restore",a),this):void 0},b.prototype.hasSpots=function(a){return null==a&&(a=1),null==this.maxItems||this.models.length-this.removedSoftly+a<=this.maxItems},b.prototype.hasChangedSinceSync=function(){var a,b,c,d;if(this.deleted||this.removedSoftly)return!0;for(d=this.models,b=0,c=d.length;c>b;b++)if(a=d[b],a.hasChangedSinceSync())return!0;return!1},b.prototype.copy=function(a){var b,c;return c=this.field.isUnique()?[]:function(){var a,c,d,e;for(d=this.models,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b.copy());return e}.call(this),new e.Fields.RelatedCollection(c,{owner:a,field:this.field})},b.prototype.serialize=function(){var a,b,c,d,e;if(this.field.isMultiple()){if(c=this.filter(function(a){return!a.isDeleted}),_.isEmpty(c))return"";for(a={},d=0,e=c.length;e>d;d++)b=c[d],a[b.cid]=b;return a}return this.find(function(a){return!a.isDeleted})||""},b}(Backbone.Collection),e.Fields.Embedded=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.viewConstructor=e.Fields.EmbeddedView,b.prototype.createInstance=function(a,b){var c,d;return b instanceof Backbone.Collection?b:(this.attributes.multiple||(b=b||this.isRequired(a)?[b]:[]),d=this.getReference(),b=function(){var a,e,f;for(f=[],a=0,e=b.length;e>a;a++)c=b[a],f.push(d.createInstance(c));return f}(),new e.Fields.RelatedCollection(b,{owner:a,field:this,maxItems:this.isMultiple()?null:1}))},b.prototype.applyValues=function(a,b){var c,d;return this.attributes.multiple||(b=[b]),a.set(_.pluck(b,"attributes"),{add:!1}),d=this.getReference(),a.add(function(){var e,f,g;for(g=[],e=0,f=b.length;f>e;e++)c=b[e],a.get(c.id)||g.push(d.createInstance(c));return g}()),this},b.prototype.hasChangedSinceSync=function(a){return a.hasChangedSinceSync()},b.prototype.copy=function(a,b){return b.copy(a)},b.prototype.processErrors=function(a,b){var c,d,e;if(_.isObject(b)){if(!this.attributes.multiple)return e=a.first(),e&&e.trigger("invalid",e,b),this;for(c in b)d=b[c],e=a.get(c),e&&e.trigger("invalid",e,d);return this}},b.prototype.triggerRelated=function(a,b,c){var d,e,f,g;for(g=b.models,e=0,f=g.length;f>e;e++)d=g[e],d.trigger.apply(d,[a,d].concat(c));return this},b.prototype.isMultiple=function(){return this.attributes.multiple},b}(e.Fields.BaseRelation),e.Fields.Number=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createFilterInput=function(a){return new e.Inputs.NumberFilter({model:a,key:this.id})},b}(e.Fields.Input),e.Fields.Computed=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.createInput=function(a){return new e.Inputs.Static({model:a,key:this.id,formatter:this})},b.prototype.isEditable=function(){return!1},b}(e.Fields.Base),e.Columns.Base=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){return null!=a.formatter&&(this.formatter=e.formatters.create(a.formatter,a.formatter_options)),b.__super__.initialize.apply(this,arguments)},b.prototype.render=function(a){return this.format(a[this.id])},b.prototype.format=function(a){return null!=this.formatter?this.formatter.format(a):_.escape(a)},b.prototype.getHeader=function(){return this.attributes.header},b.prototype.getClass=function(){return"col-"+this.id+(this.canOrder()?" col__sortable":"")},b.prototype.canOrder=function(){return this.attributes.can_order},b}(e.Attribute),e.Columns.Proxy=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){var c,d;return c=null!=(d=a.field)?d:a.id,this.field=a.entity.fields.get(c),b.__super__.initialize.apply(this,arguments)},b.prototype.format=function(a){return null!=this.formatter?this.formatter.format(a):this.field.format(a)},b.prototype.getClass=function(){return b.__super__.getClass.apply(this,arguments)+" col__"+this.field.get("type")},b}(e.Columns.Base),e.Columns.Computed=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.getClass=function(){return b.__super__.getClass.apply(this,arguments)+" col__computed"},b}(e.Columns.Base),e.Columns.ViewButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.id="__viewButton",b.prototype.getHeader=function(){return""},b.prototype.getClass=function(){return"col__view-button col__button"},b.prototype.canOrder=function(){return!1},b.prototype.render=function(a){return'<a href="'+this.entity.link(a.id)+'" class="btn btn-default btn-xs">\n    '+s("pencil")+"\n</a>"},b}(e.Columns.Base),e.Columns.DeleteButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.id="__deleteButton",b.prototype.getHeader=function(){return""},b.prototype.getClass=function(){return"col__delete-button col__button"},b.prototype.canOrder=function(){return!1},b.prototype.render=function(){return'<a href="#" data-action="deleteItem" class="btn btn-default btn-xs">\n    '+s("trash")+"\n</a>"},b}(e.Columns.Base),e.Filters.Base=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.getLabel=function(){return this.attributes.label},b.prototype.getClass=function(){return"filter filter__"+this.attributes.type+" filter--"+this.id},b.prototype.createFilterInput=function(){throw"Implement required"},b}(e.Attribute),e.Filters.Proxy=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){var c,d;return c=null!=(d=a.field)?d:a.id,this.field=a.entity.fields.get(c),b.__super__.initialize.apply(this,arguments)},b.prototype.createFilterInput=function(a){return this.field.createFilterInput(a)},b}(e.Filters.Base),d=function(){function a(a){null==a&&(a={}),this.options=$.extend({},this.defaultOptions,a)}return a.prototype.defaultOptions={},a.prototype.format=function(a){return a},a}(),e.formatters.Image=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.defaultOptions={width:40,height:40},b.prototype.format=function(a){return _.isEmpty(a)?"":(_.isArray(a)&&(a=a[0]),_.isObject(a)&&(a=a.title),'<a href="'+(e.root+"/"+a)+'" data-trigger="fancybox">\n    <img src="'+w(a,this.options.width,this.options.height)+'" '+(this.options.width?" width="+this.options.width:"")+" "+(this.options.height?" height="+this.options.height:"")+' alt="'+_.escape(a)+'">\n</a>')},b}(d),e.formatters.Plain=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.format=function(a){return a},b}(d),e.Entity={},e.Entity.Entity=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(a){return this.fields=this.createObjects(a.fields),this.columns=this.createObjects(a.columns),this.filters=this.createObjects(a.filters),this.permissions=e.permissions[this.id],this.cache={},this},b.prototype.createObjects=function(a){var b,c,d,e,f;for(c=[],e=0,f=a.length;f>e;e++){if(d=a[e],d.entity=this,b=u(d["class"]),!b)throw"The class "+d["class"]+" is not found";c.push(new b(d))}return new Backbone.Collection(c)},b.prototype.createDataSource=function(a){var b,c;return c={order_by:this.get("order_by")},(b=this.columns.get(c.order_by))&&(c.order_dir=b.get("order_dir")),a=$.extend({},c,a),new g(a,{entity:this})},b.prototype.createFilters=function(a){var b,c;return null==a&&(a=this.columns),c=function(){var c,d,e,f;for(e=a.models,f=[],c=0,d=e.length;d>c;c++)b=e[c],"complex"===b.get("filter_type")&&f.push(b.createFilter());return f}(),new Backbone.Collection(c)},b.prototype.createInstance=function(a,b){var c,d;return null==a&&(a={}),null==b&&(b={}),b.entity=this,c=_.extend({},this.get("defaults"),a.attributes),d=new e.Entity.Instance(c,b),d.fillExtra(a),d},b.prototype.getRelation=function(a){var b;return b=this.field(a),!b instanceof e.Fields.BaseRelation?void console.error("The field "+a+" is not a relation."):b},b.prototype.field=function(a){var b;return(b=this.fields.get(a))?b:void console.error("The field "+a+" is not found.")},b.prototype.search=function(a){return null==a&&(a={}),new n({},$.extend({url:this.url()},a))},b.prototype.load=function(a,b){var c,d;return c={cached:!0},b=$.extend(c,b),b.cached&&a in this.cache?$.Deferred().resolve(this.cache[a]).promise():(d=$.ajax({url:this.url(a),type:"GET",dataType:"json",displayLoading:!0}),d=d.then(function(a){return function(b){var c;return c=a.createInstance(b),a.cache[c.id]=c,c}}(this)))},b.prototype.destroy=function(a,b){return null==b&&(b={}),b.url=this.url(a),b.type="POST",b.dataType="json",b.data={_method:"DELETE"},$.ajax(b)},b.prototype.actionUpdate=function(a){return this.load(a).then(function(a){return function(b){return a.set("instance",b),b}}(this))},b.prototype.actionCreate=function(){return this.set("instance",this.createInstance())},b.prototype.getCopyableAttributes=function(a,b){var c,d,e,f,g,h,i,j,k;for(c={},j=this.fields.models,f=0,h=j.length;h>f;f++)d=j[f],!d.isUnique()&&d.id in b&&!_.contains(this.attributes.related,d.id)&&(c[d.id]=b[d.id]);for(k=this.attributes.related,g=0,i=k.length;i>g;g++)e=k[g],e in b&&(c[e]=this.getRelation(e).copy(a,b[e]));return c},b.prototype.url=function(a){return t(this.id,a)},b.prototype.link=function(a){var b;return b=this.url(),a instanceof e.Entity.Instance&&(a=a.id),a?b+"?id="+a:b},b.prototype.createView=function(){var a;if(a=u(this.attributes.view),!a)throw"Failed to resolve page class "+this.attributes.view;return new a({model:this})},b.prototype.getPluralTitle=function(){return this.attributes.title.plural},b.prototype.getSingularTitle=function(){return this.attributes.title.singular},b.prototype.getPermissions=function(){return this.permissions},b.prototype.updatePermitted=function(){return this.permissions.update},b.prototype.createPermitted=function(){return this.permissions.create},b.prototype.deletePermitted=function(){return this.permissions["delete"]},b.prototype.viewPermitted=function(){return this.permissions.view},b.prototype.isSoftDeleting=function(){return this.attributes.soft_deleting},b}(Backbone.Model),e.Entity.Instance=function(b){function c(a,b){this.entity=b.entity,this.related={},c.__super__.constructor.apply(this,arguments)}return z(c,b),c.prototype.initialize=function(a){var b,c,d,e;for(this.original=_.clone(a),this.on("error",this.handleErrorEvent,this),this.on("invalid",this.handleInvalidEvent,this),this.on("sync",this.handleSyncEvent,this),this.on("destroy",this.handleDestroyEvent,this),e=["sync","request"],c=0,d=e.length;d>c;c++)b=e[c],this.on(b,this.triggerRelated(b),this);return this},c.prototype.handleSyncEvent=function(a,b){return this.original=_.clone(this.attributes),b.attributes&&this.fillExtra(b),this},c.prototype.fillExtra=function(a){var b,c;return this.extra=null!=(b=a.extra)?b:{},this.title=null!=(c=a.title)?c:null,this},c.prototype.triggerRelated=function(a){var b;return b=Array.prototype.slice,function(){var c,d,e,f;f=this.related;for(c in f)d=f[c],e=this.entity.getRelation(c),e.triggerRelated.call(e,a,d,b.call(arguments,1));return this}},c.prototype.handleInvalidEvent=function(a,b){var c,d;d=this.related;for(c in d)a=d[c],c in b&&this.entity.getRelation(c).processErrors(a,b[c]);return this},c.prototype.handleErrorEvent=function(a,b){400===b.status&&this.trigger("invalid",this,b.responseJSON)},c.prototype.handleDestroyEvent=function(){this.isDeleted=!0},c.prototype.validate=function(){return this.set("errors",{}),null},c.prototype.link=function(){return this.entity.link(this.isNew()?"create":this.id)},c.prototype.url=function(){return this.entity.url(this.id)},c.prototype.set=function(a,b,d){var e,f,g,h,i,j,k,l,m;if("object"==typeof a)for(e=a,d=b,g=null!=d?d.is_copy:void 0,m=this.entity.get("related"),k=0,l=m.length;l>k;k++)f=m[k],f in e&&(i=this.entity.getRelation(f),j=e[f],h=this.related[f]=g?j:i.createInstance(this,j),e[f]=h);return c.__super__.set.apply(this,arguments)},c.prototype.sync=function(b,d,e){var f;return("update"===b||"create"===b)&&(e.data=new a(null!=(f=e.attrs)?f:this.attributes).original,e.contentType=!1,e.processData=!1),c.__super__.sync.apply(this,arguments)},c.prototype.parse=function(a){return a.attributes},c.prototype.copy=function(){var a;return a=this.entity.createInstance(),a.set(this.getCopyableAttributes(a),{silent:!0,is_copy:!0}),a},c.prototype.getCopyableAttributes=function(a){return this.entity.getCopyableAttributes(a,this.attributes)},c.prototype.hasChangedSinceSync=function(){var a,b,c;c=this.attributes;for(a in c)if(b=c[a],a in this.related?this.entity.getRelation(a).hasChangedSinceSync(b):!_.isEqual(b,this.original[a]))return!0;return!1},c.prototype.isSaveable=function(){return this.isNew()&&this.entity.createPermitted()||!this.isNew()&&this.entity.updatePermitted()},c.prototype.serialize=function(){return{attributes:this.attributes,id:this.id}},c.prototype.action=function(){return this.isNew()?"create":"update"},c.prototype.getTitle=function(){var a;return null!=(a=this.title)?a:e.lang.model_new_record},c}(Backbone.Model),e.Entity.Page=function(a){function b(a){this.className+=" entity-page-"+a.model.id,b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.className="page entity-page",b.prototype.events={"click .ep-btn-create":"create","click .ep-btn-refresh":"refreshData"},b.prototype.initialize=function(){return this.dataSource=this.model.createDataSource(this.getDatasourceData()),q(function(a){return function(){return a.listenTo(a.dataSource,"change",function(a){return e.router.refreshQuery(this.getDatasourceDefaults(),a.attributes,{trigger:!1})}),a.listenTo(e.router,"route:index",a.handleRouteUpdated)}}(this)),b.__super__.initialize.apply(this,arguments)},b.prototype.pageUnloadConfirmationMessage=function(){var a;return null!=(a=this.form)?a.pageUnloadConfirmationMessage():void 0},b.prototype.handleRouteUpdated=function(){return this.dataSource.set(this.getDatasourceData()),this._displayForm().fail(function(a){return function(){return a._syncQueryParameters({replace:!0})}}(this)),this},b.prototype.getDatasourceData=function(){return _.pick(e.router.query.keys,"search","per_page","order_dir","order_by")},b.prototype.getDatasourceDefaults=function(){var a,b;return this.dsDefaults?this.dsDefaults:(this.dsDefaults=b={current_page:1,order_by:this.model.get("order_by"),order_dir:"asc",search:""},b.order_by&&(a=this.model.columns.get(b.order_by))&&(b.order_dir=a.get("order_dir")),b)},b.prototype._syncQueryParameters=function(a){var b;return b=e.router,a=$.extend({trigger:!1,replace:!1},a),this.form?b.setQuery("id",this.form.model.id||"new",a):b.removeQuery("id",a),this},b.prototype._displayForm=function(a){var b,c,d,f,g;if(!this.loadingForm)return a=null!=a?a:e.router.getQuery("id"),a instanceof e.Entity.Instance&&(d=a,a=d.id||"new"),this.loadingForm=c=$.Deferred(),this.loadingForm.always(function(a){return function(){return a.loadingForm=null}}(this)),this.form&&(b=this.form.model.isNew()?"new":this.form.model.id,a===b||!this.form.confirmClose())?(c.reject(),c.promise()):(f=function(a){return function(b){return a._createAndRenderForm(b),c.resolve(b)}}(this),"new"!==a||d||(d=this.model.createInstance()),d?(f(d),c.promise()):(a?this.model.load(a).done(f).fail(function(){return c.reject()}):(null!=(g=this.form)&&g.remove(),c.resolve()),c.promise()))},b.prototype._createAndRenderForm=function(a){var b,c;return null!=(c=this.form)&&c.remove(),this.form=b=e.Entity.Form.display(a),b.on("close",function(){return function(){return e.router.removeQuery("id",{trigger:!1})}}(this)),b.on("created",function(a){return e.router.setQuery("id",a.id)}),b.on("remove",function(b){return function(){return b.form=null,b.model.set("instance",null),b.stopListening(a)}}(this)),b.on("saved",function(a){return function(){return a.dataSource.fetch()}}(this)),b.on("saved remove",function(){return e.app.updateTitle()}),this.model.set("instance",a),e.app.updateTitle(),this},b.prototype.displayForm=function(a){return this._displayForm(a).done(function(a){return function(){return a._syncQueryParameters()}}(this))},b.prototype.create=function(){return this.displayForm("new"),this},b.prototype.refreshData=function(a){var b;return b=$(a.currentTarget),b.prop("disabled",!0),this.dataSource.fetch().always(function(){return b.prop("disabled",!1)}),this},b.prototype.render=function(){return this.$el.html(this.template()),this.searchInputView=this.createSearchInputView(),this.dataView=this.createDataView(),this.paginationView=this.createPaginationView(),this.filterListView=this.createFilterListView(),this.searchInputView&&this.$component("search_input_view").append(this.searchInputView.render().$el),this.filterListView&&this.$component("filter_list_view").append(this.filterListView.render().el),this.dataView&&this.$component("data_view").append(this.dataView.render().el),this.paginationView&&this.$component("pagination_view").append(this.paginationView.render().el),this.handleRouteUpdated(),this.dataSource.fetch(),this},b.prototype.createDataView=function(){return new f({model:this.dataSource,entity:this.model})},b.prototype.createPaginationView=function(){return new l({model:this.dataSource})},b.prototype.createFilterListView=function(){var a;if(!(a=this.dataSource.entity.filters).isEmpty())return new j({model:this.dataSource.filter,entity:this.model,filters:a})},b.prototype.createSearchInputView=function(){return new e.Inputs.Search({model:this.dataSource,key:"search"})},b.prototype.template=function(){return'<div class="content-header">\n    <div class="column column-main">\n        <h1 class="entity-title">'+this.model.getPluralTitle()+'</h1>\n\n        <div class="entity-title-buttons">\n            '+this.buttonsTemplate()+'\n        </div>\n    </div>\n\n    <div class="column column-extra">\n        <div class="entity-search-box" id="'+this.componentId("search_input_view")+'"></div>\n    </div>\n</div>\n\n<div class="content-body">\n    <div class="column column-main">\n        <div id="'+this.componentId("data_view")+'"></div>\n        <div id="'+this.componentId("pagination_view")+'"></div>\n    </div>\n\n    <div class="column column-extra" id="'+this.componentId("filter_list_view")+'"></div>\n</div>'},b.prototype.buttonsTemplate=function(){var a;return a='<button type="button" class="btn btn-default ep-btn-refresh" title="'+e.lang.refresh+'">\n    '+s("refresh")+"\n</button>",a+=" ",this.model.createPermitted()&&(a+='<button type="button" class="btn btn-primary ep-btn-create" title="'+e.lang.add+'">\n    '+s("plus")+"\n</button>"),a},b.prototype.remove=function(){var a,c,d,e,f,g;return null!=(a=this.form)&&a.remove(),null!=(c=this.filterListView)&&c.remove(),null!=(d=this.dataView)&&d.remove(),null!=(e=this.paginationView)&&e.remove(),null!=(f=this.searchInputView)&&f.remove(),null!=(g=this.dataSource)&&g.stopListening(),b.__super__.remove.apply(this,arguments)},b.prototype.getPageTitle=function(){var a;return a=this.model.getPluralTitle(),null!=this.form&&(a=this.form.model.getTitle()+o+a),a},b}(e.View),e.Entity.Form=function(a){function c(a){this.className+=" "+this.className+"-"+a.model.entity.id,c.__super__.constructor.apply(this,arguments)}return z(c,a),c.prototype.className="entity-form",c.prototype.events={"click .btn-save":"save","click .btn-close":"close","click .btn-destroy":"destroy","click .btn-copy":"copy","click .fs-btn-refresh":"refresh"},c.prototype.initialize=function(){return c.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"destroy",this.handleModelDestroyEvent),this.listenTo(this.model,"invalid",this.handleModelInvalidEvent),this.hotkeys=$(document).on("keydown."+this.cid,"body",$.proxy(this,"hotkeys")),this},c.prototype.setupDefaultLayout=function(){var a,b,c,d,f;for(b=this.append(new e.Layout.TabPane({title:this.model.entity.get("title").singular},this)),f=this.entity.fields.models,c=0,d=f.length;d>c;c++)a=f[c],b.append(new e.Layout.Field({field:a.id},b));return this},c.prototype.hotkeys=function(a){return a.ctrlKey&&90===a.keyCode&&a.target===document.body?(this.model.set(this.model.previousAttributes()),!1):a.ctrlKey&&13===a.keyCode?(this.save(),!1):27===a.keyCode?(this.close(),!1):this},c.prototype.displayAlert=function(a,c,d){return null!=this.alert&&this.alert.remove(),this.alert=new b({message:a,className:"flash",type:c,timeout:d}),this.footer.prepend(this.alert.render().el),this},c.prototype.displaySuccess=function(){return this.displayAlert(e.lang.success,"success",3e3)},c.prototype.displayError=function(a){return 400!==a.status?this.displayAlert(e.lang.failure,"danger",5e3):void 0},c.prototype.handleModelInvalidEvent=function(){return this.displayAlert(e.lang.invalid,"warning",5e3)},c.prototype.handleModelDestroyEvent=function(){return this.update(),this.trigger("destroyed",this.model),this},c.prototype.show=function(){return this.$el.toggleClass("opened",!0),this.items[0].activate(),this.focus(),this},c.prototype.refresh=function(){return null==this.request?(this.confirmClose()&&this.setupRequest(this.model.fetch()),this):void 0},c.prototype.save=function(){var a;if(null==this.request)return a=this.model.isNew(),this.setupRequest(this.model.save(null,{displayLoading:!0,xhr:function(a){return function(){var b;return b=$.ajaxSettings.xhr(),b.upload&&b.upload.addEventListener("progress",$.proxy(a,"progressCallback")),b}}(this)})),this.request.done(function(b){return function(c){return b.trigger(a?"created":"updated",b.model,c),b.trigger("saved",b.model,c)}}(this)),this},c.prototype.setupRequest=function(a){return a.done($.proxy(this,"displaySuccess")).fail($.proxy(this,"displayError")),a.always(function(a){return function(){return a.request=null,a.update()}}(this)),this.request=a,this.update()},c.prototype.progressCallback=function(a){var b;return a.lengthComputable&&(b=100*a.loaded/a.total,this.progressBar.width(b+"%").parent().show(),100===b&&this.progressBar.parent().hide()),this},c.prototype.close=function(){return this.confirmClose()&&(this.remove(),this.trigger("close")),this},c.prototype.pageUnloadConfirmationMessage=function(){return this.model.isDeleted?void 0:this.request?e.lang.onclose_abort:this.model.hasChangedSinceSync()?e.lang.onclose_discard:void 0},c.prototype.confirmClose=function(){if(!this.model.isDeleted){if(this.request)return confirm(e.lang.confirm_abort);if(this.model.hasChangedSinceSync())return confirm(e.lang.confirm_discard)}return!0},c.prototype.destroy=function(){var a,b;if(!this.request&&!this.model.isNew())return b=this.model.entity.get("soft_deleting"),a=b?!0:confirm(e.lang.confirm_delete),a&&(this.request=this.softDeleting&&this.model.get("deleted_at")?this.model.restore:this.model.destroy({wait:!0}),this.request.always(function(a){return function(){return a.request=null}}(this))),this},c.prototype.copy=function(){return e.app.entityView.displayForm(this.model.copy()),this},c.prototype.render=function(){return this.$el.html(this.template()),this.$container=this.$component("body"),this.nav=this.$component("nav"),this.footer=this.$("footer"),this.submit=this.$(".btn-save"),this.$deletedMsg=this.$component("deleted-message"),this.destroy=this.$(".btn-destroy"),this.copy=this.$(".btn-copy"),this.$refresh=this.$(".fs-btn-refresh"),this.progressBar=this.$(".form-save-progress"),this.update(),c.__super__.render.apply(this,arguments)},c.prototype.renderElement=function(a){return this.nav.append(a.getHeader().render().$el),c.__super__.renderElement.apply(this,arguments)},c.prototype.update=function(){var a,b,c,d;return c=this.model.entity.getPermissions(),b=this.model.isNew(),a=this.model.isDeleted||!1,this.$el.toggleClass("loading",null!=this.request),this.submit.text(b?e.lang.create:e.lang.save),this.submit.attr("disabled",null!=this.request),this.submit.toggle(!a&&(b?c.create:c.update)),this.destroy.attr("disabled",null!=this.request),this.destroy.toggle(!a&&!b&&c["delete"]),this.$deletedMsg.toggle(a),this.copy.toggle(!b&&c.create),this.$refresh.attr("disabled",null!=this.request),this.$refresh.toggle(!b&&!a),null!=(d=this.external)&&d.remove(),this.model.extra.external&&this.$refresh.after(this.external=$(this.externalLinkTemplate(this.model.extra.external))),this},c.prototype.template=function(){return'<div class="navbar navbar-default navbar-static-top" role="navigation">\n    <div class="container-fluid">\n        <ul id="'+this.componentId("nav")+'" class="nav navbar-nav"></ul>\n    </div>\n</div>\n\n<div class="tab-content" id="'+this.componentId("body")+'"></div>\n\n<footer>\n    <div class="pull-left">\n        <button type="button" class="btn btn-link btn-destroy" title="'+e.lang.model_delete+'">\n            <span class="glyphicon glyphicon-trash"></span>\n        </button>\n\n        <button type="button" tabindex="-1" class="btn btn-link btn-copy" title="'+e.lang.model_copy+'">\n            <span class="glyphicon glyphicon-book"></span>\n        </button>\n\n        <button type="button" class="btn btn-link fs-btn-refresh" title="'+e.lang.model_refresh+'">\n            <span class="glyphicon glyphicon-refresh"></span>\n        </button>\n    </div>\n\n    <span class="fs-deleted-message" id="'+this.componentId("deleted-message")+'">'+e.lang.model_deleted+'</span>\n    <button type="button" class="btn btn-default btn-close">'+e.lang.close+'</button>\n    <button type="button" class="btn btn-primary btn-save"></button>\n\n    <div class="progress"><div class="progress-bar form-save-progress"></div></div>\n</footer>'},c.prototype.externalLinkTemplate=function(a){return'<a href="'+a+'" class="btn btn-link" title="'+e.lang.view_external+'" target="_blank">\n    '+s("eye-open")+"\n</a>"},c.prototype.remove=function(){return this.trigger("remove",this),this.request&&this.request.abort(),this.$el.one(p,function(a){return function(){return $(document).off("."+a.cid),a.trigger("removed",a),c.__super__.remove.apply(a,arguments)}}(this)).removeClass("opened"),c.__super__.remove.apply(this,arguments)},c}(e.Layout.Layout),e.Entity.Form.display=function(a){var b;return b=new e.Entity.Form({model:a}),$(document.body).append(b.render().$el),q(function(){return function(){return b.show()}}(this)),b},c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(){return this.container=$("body"),this.mainContent=$("#content"),this.loadingRequests=0,this.entities={},this.dfd=$.Deferred(),this.$title=$("title"),this.$error=$(this.errorTemplate()).appendTo(this.container),this.$error.on("click",".close",function(a){return function(){return a.$error.stop(!0).fadeOut()}}(this)),this.on("change:entity",this.displayEntity,this),$(document).ajaxError(function(a){return function(b,c,d){return a.handleAjaxError(c,d)}}(this)),$(window).on("beforeunload",function(a){return function(){return a.pageUnloadConfirmationMessage()}}(this)),this},b.prototype.errorTemplate=function(){return'<p class="alert alert-danger cruddy-global-error">\n    <button type="button" class="close">&times;</button>\n    <span class="data"></span>\n</p>'},b.prototype.init=function(){return this._loadSchema(),this},b.prototype.ready=function(a){return this.dfd.done(a)},b.prototype._loadSchema=function(){var a;
return a=$.ajax({url:e.schemaUrl,displayLoading:!0}),a.done(function(a){return function(b){var c,d,f;for(d=0,f=b.length;f>d;d++)c=b[d],a.entities[c.id]=new e.Entity.Entity(c);a.dfd.resolve(a)}}(this)),a.fail(function(a){return function(){a.dfd.reject(),a.displayError(e.lang.schema_failed)}}(this)),a},b.prototype.displayEntity=function(a,b){return this.dispose(),this.mainContent.hide(),b&&this.container.append((this.entityView=b.createView()).render().el),this.updateTitle()},b.prototype.displayError=function(a){return this.dispose(),this.mainContent.html("<p class='alert alert-danger'>"+a+"</p>").show(),this},b.prototype.handleAjaxError=function(a){var b;(null!=(b=a.responseJSON)?b.error:void 0)&&this.$error.children(".data").text(a.responseJSON.error).end().stop(!0).fadeIn()},b.prototype.pageUnloadConfirmationMessage=function(){var a;return null!=(a=this.entityView)?a.pageUnloadConfirmationMessage():void 0},b.prototype.startLoading=function(){return 0===this.loadingRequests++&&(this.loading=setTimeout(function(a){return function(){return $(document.body).addClass("loading"),a.loading=!1}}(this),1e3)),this},b.prototype.doneLoading=function(){return 0===this.loadingRequests?void console.error("Seems like doneLoading is called too many times."):(0===--this.loadingRequests&&(this.loading?(clearTimeout(this.loading),this.loading=!1):$(document.body).removeClass("loading")),this)},b.prototype.entity=function(a){if(!(a in this.entities))throw"Unknown entity "+a;return this.entities[a]},b.prototype.dispose=function(){var a;return null!=(a=this.entityView)&&a.remove(),this.entityView=null,this},b.prototype.updateTitle=function(){var a;return a=e.brandName,null!=this.entityView&&(a=this.entityView.getPageTitle()+o+a),this.$title.text(a),this},b}(Backbone.Model),m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.prototype.initialize=function(){var a,b,c;return this.query=$.query,a=e.entities,this.addRoute("index",a),c=e.baseUrl,b=Backbone.history,$(document.body).on("click","a",function(){return function(a){var d,e,f,g,h;if(d=a.currentTarget.href,0===d.indexOf(c))for(d=b.getFragment(d.slice(c.length)),h=b.handlers,f=0,g=h.length;g>f;f++)if(e=h[f],e.route.test(d)){a.preventDefault(),b.navigate(d,{trigger:!0});break}}}(this)),this},b.prototype.execute=function(){return this.query=$.query.parseNew(location.search),b.__super__.execute.apply(this,arguments)},b.prototype.navigate=function(a){return this.query=this.query.load(a),b.__super__.navigate.apply(this,arguments)},b.prototype.getQuery=function(a){return this.query.GET(a)},b.prototype.setQuery=function(a,b,c){return this.updateQuery(this.query.set(a,b),c)},b.prototype.refreshQuery=function(a,b,c){var d,e,f,g;e=this.query.copy();for(d in a)f=a[d],(g=b[d])!==f?e.SET(d,g):e.REMOVE(d);return this.updateQuery(e,c)},b.prototype.removeQuery=function(a,b){return this.updateQuery(this.query.remove(a),b)},b.prototype.updateQuery=function(a,b){var c,d,f;return(d=a.toString())!==this.query.toString()&&(this.query=a,c=location.pathname,f="/"+e.uri+"/",0===c.indexOf(f)&&(c=c.slice(f.length)),Backbone.history.navigate(c+d,b)),this},b.prototype.addRoute=function(a,b,c){var d;return null==c&&(c=null),d="^("+b+")",c&&(d+="/"+c),d+="(\\?.*)?$",this.route(new RegExp(d),a),this},b.prototype.resolveEntity=function(a,b){return e.ready(function(c){var d;d=c.entity(a),d.viewPermitted()?(e.app.set("entity",d),b&&b.call(this,d)):e.app.displayError(e.lang.entity_forbidden)})},b.prototype.index=function(a){return this.resolveEntity(a)},b}(Backbone.Router),$(function(){return e.router=new m,Backbone.history.start({root:e.getHistoryRoot(),pushState:!0,hashChange:!1})})}).call(this);
//# sourceMappingURL=app.min.map